---
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';
import SEO from '../../components/SEO.astro';
import ScrollProgress from '../../components/ScrollProgress.astro';
import Nav from '../../components/Nav.astro';
import Search from '../../components/Search.astro';
import { generateTagsForPost } from '../../utils/tag-generator';
import '../../styles/global.css';

// Get all blog posts, sorted by date
const posts = await getCollection('blog', ({ data }) => !data.draft && !data.page);
const sortedPosts = posts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

// Generate tags for each post at build time
const postsWithTags = await Promise.all(
  sortedPosts.map(async (post) => {
    const tags = await generateTagsForPost({
      slug: post.id,
      title: post.data.title,
      description: post.data.description,
    });
    return { ...post, generatedTags: tags };
  })
);
---

<!DOCTYPE html>
<html lang="en">
<head>
  <SEO
    title="Blog | Neurohackingly"
    description="Articles on productivity, AI, and personal growth"
    category="blog"
  />
</head>
<body>
  <ScrollProgress />
  <Nav />

  <main>
    <header>
      <h1>Blog</h1>
      <p>Exploring productivity, AI, and personal growth</p>
    </header>

    <div class="search-section">
      <Search inline={false} placeholder="Search all blog posts..." />
    </div>

    <div class="posts-list">
      {postsWithTags.map((post) => (
        <article class="post-item">
          <div class="post-header">
            <h2>
              <a href={`/blog/${post.id}`}>{post.data.title}</a>
            </h2>
            <time datetime={post.data.pubDate.toISOString()}>
              {post.data.pubDate.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
              })}
            </time>
          </div>
          {post.generatedTags.length > 0 && (
            <div class="post-tags">
              {post.generatedTags.map(tag => (
                <span class="minimal-tag">{tag}</span>
              ))}
            </div>
          )}
        </article>
      ))}
    </div>
  </main>

  <footer>
    <p>Â© 2025 Neurohackingly by Lukas Zangerl</p>
  </footer>

  <style>
    .search-section {
      max-width: 100%;
      margin: 2rem 0 3rem;
      padding: 0 1rem;
    }

    /* Minimal List Layout */
    .posts-list {
      display: flex;
      flex-direction: column;
      gap: 0;
      max-width: 100%;
      margin: 0 auto;
    }

    .post-item {
      padding: 2rem 0;
      border-bottom: 1px solid var(--color-border-light);
    }

    .post-item:last-child {
      border-bottom: none;
    }

    .post-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 2rem;
    }

    .post-item h2 {
      font-family: var(--font-serif);
      font-size: 1.5rem;
      font-weight: 700;
      margin: 0 0 0.5rem 0;
      line-height: 1.3;
      flex: 1;
    }

    .post-item h2 a {
      color: var(--color-text);
      text-decoration: none;
    }

    .post-item h2 a:hover {
      text-decoration: underline;
      text-decoration-thickness: 1px;
      text-underline-offset: 3px;
    }

    .post-item time {
      color: var(--color-text-light);
      font-size: 0.9rem;
      white-space: nowrap;
      font-variant-numeric: tabular-nums;
      flex-shrink: 0;
    }

    .post-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.25rem;
    }

    .minimal-tag {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      background: var(--color-bg-light);
      color: var(--color-text-medium);
      font-size: 0.75rem;
      border-radius: 3px;
      font-weight: 600;
      letter-spacing: 0.03em;
      text-transform: uppercase;
    }

    /* Mobile - up to 640px */
    @media (max-width: 640px) {
      main {
        padding: 2rem 1rem;
      }

      .posts-list {
        padding: 0;
      }

      .post-item {
        padding: 1.5rem 0;
      }

      .post-header {
        flex-direction: column;
        gap: 0.25rem;
        align-items: flex-start;
      }

      .post-item h2 {
        font-size: 1.25rem;
        margin-bottom: 0.35rem;
      }

      .post-item time {
        font-size: 0.85rem;
        color: var(--color-text-medium);
      }

      .post-tags {
        margin-top: 0.5rem;
      }

      .minimal-tag {
        font-size: 0.7rem;
        padding: 0.2rem 0.6rem;
      }
    }

    /* Tablet - 641px to 1024px */
    @media (min-width: 641px) and (max-width: 1024px) {
      .posts-list {
        max-width: 720px;
      }

      .post-item {
        padding: 1.75rem 0;
      }

      .post-item h2 {
        font-size: 1.4rem;
      }
    }

    /* Desktop - 1025px and up */
    @media (min-width: 1025px) {
      .posts-list {
        max-width: 800px;
      }

      .post-item {
        padding: 2rem 0;
      }

      .post-item h2 {
        font-size: 1.6rem;
      }
    }

    /* Dark mode adjustments */
    @media (prefers-color-scheme: dark) {
      .search-link a {
        color: #63b3ed;
      }

      .search-link a:hover {
        color: #93c5fd;
      }

      .minimal-tag {
        background: rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.7);
      }
    }
  </style>
</body>
</html>
