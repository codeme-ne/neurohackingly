---
import { getCollection } from 'astro:content';
import SEO from '../../components/SEO.astro';
import ScrollProgress from '../../components/ScrollProgress.astro';
import MinimalNav from '../../components/MinimalNav.astro';
import '../../styles/global.css';

const posts = await getCollection('blog', ({ data }) => !data.draft);
const sortedPosts = posts
  .slice()
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const postsWithTags = sortedPosts.map((post) => {
  const sources = [...(post.data.tags ?? []), ...(post.data.topics ?? [])];
  const seen = new Set<string>();
  const displayTags: string[] = [];

  for (const rawTag of sources) {
    const tag = rawTag.trim();
    if (!tag) continue;

    const key = tag.toLowerCase();
    if (key.startsWith('hash-') || seen.has(key)) continue;

    seen.add(key);
    displayTags.push(tag);
  }

  return {
    entry: post,
    displayTags
  };
});
---

<!DOCTYPE html>
<html lang="en">
<head>
  <SEO
    title="Blog | Neurohackingly"
    description="Articles on productivity, AI, and personal growth"
    category="blog"
  />
</head>
<body>
  <ScrollProgress />
  <MinimalNav />

  <main class="blog">
    <header class="blog__hero">
      <h1>Blog</h1>
      <p>Exploring productivity, AI, and personal growth</p>
    </header>

    <div class="posts-list">
      {postsWithTags.map(({ entry, displayTags }) => (
        <article class="post-item">
          <div class="post-header">
            <h2>
              <a href={`/${entry.slug}`}>{entry.data.title}</a>
            </h2>
            <time datetime={entry.data.pubDate.toISOString()}>
              {entry.data.pubDate.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
              })}
            </time>
          </div>

          {entry.data.description?.trim() && (
            <p class="post-summary">{entry.data.description}</p>
          )}

          {displayTags.length > 0 && (
            <div class="post-tags">
              {displayTags.slice(0, 4).map((tag) => (
                <a href={`/blog/tag/${encodeURIComponent(tag)}`} class="minimal-tag">#{tag}</a>
              ))}
            </div>
          )}
        </article>
      ))}
    </div>
  </main>

  <footer>
    <p>Â© 2025 Neurohackingly by Lukas Zangerl</p>
  </footer>

  <style>
    .blog {
      max-width: 800px;
      margin: 0 auto;
      padding: 3rem 1.5rem;
    }

    .blog__hero {
      text-align: center;
      margin-bottom: 3rem;
    }

    .blog__hero h1 {
      margin-bottom: 0.5rem;
    }

    .blog__hero p {
      margin: 0;
      color: var(--color-text-light);
    }

    .posts-list {
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    .post-item {
      padding: 2rem 0;
      border-bottom: 1px solid var(--color-border-light);
    }

    .post-item:first-child {
      border-top: 1px solid var(--color-border-light);
    }

    .post-item:last-child {
      border-bottom: none;
    }

    .post-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 2rem;
    }

    .post-item h2 {
      font-family: var(--font-serif);
      font-size: 1.5rem;
      font-weight: 700;
      margin: 0 0 0.5rem;
      line-height: 1.3;
      flex: 1;
    }

    .post-item h2 a {
      color: var(--color-text);
      text-decoration: none;
    }

    .post-item h2 a:hover {
      text-decoration: underline;
      text-decoration-thickness: 1px;
      text-underline-offset: 3px;
    }

    .post-item time {
      color: var(--color-text-light);
      font-size: 0.9rem;
      white-space: nowrap;
      font-variant-numeric: tabular-nums;
      flex-shrink: 0;
    }

    .post-summary {
      margin: 0 0 0.75rem;
      color: var(--color-text-light);
      font-size: 0.95rem;
      line-height: 1.6;
    }

    .post-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .minimal-tag {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      background: var(--color-bg-light);
      color: var(--color-text-medium);
      font-size: 0.75rem;
      border-radius: 3px;
      font-weight: 600;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      text-decoration: none;
    }

    .minimal-tag:hover {
      background: var(--color-accent);
      color: var(--color-text);
    }

    @media (max-width: 640px) {
      .blog {
        padding: 2rem 1rem;
      }

      .post-item {
        padding: 1.5rem 0;
      }

      .post-header {
        flex-direction: column;
        gap: 0.35rem;
        align-items: flex-start;
      }

      .post-item h2 {
        font-size: 1.25rem;
        margin-bottom: 0.35rem;
      }

      .post-item time {
        font-size: 0.85rem;
      }

      .post-summary {
        font-size: 0.9rem;
      }

      .minimal-tag {
        font-size: 0.7rem;
        padding: 0.2rem 0.6rem;
      }
    }

    @media (prefers-color-scheme: dark) {
      .minimal-tag {
        background: rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.7);
      }

      .minimal-tag:hover {
        color: var(--color-text);
      }
    }
  </style>
</body>
</html>
