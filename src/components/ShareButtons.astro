---
interface Props {
  url: string;
  title: string;
}

const { url, title } = Astro.props;

// URL encode for social sharing
const encodedUrl = encodeURIComponent(url);
const encodedTitle = encodeURIComponent(title);

// Social share URLs
const twitterUrl = `https://twitter.com/intent/tweet?text=${encodedTitle}&url=${encodedUrl}`;
const linkedinUrl = `https://linkedin.com/sharing/share-offsite/?url=${encodedUrl}`;
---

<div class="share-buttons">
  <span class="share-label">Share:</span>

  <a
    href={twitterUrl}
    target="_blank"
    rel="noopener noreferrer"
    class="share-btn share-twitter"
    aria-label="Share on X/Twitter"
  >
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M4 4l11.733 16h4.267l-11.733 -16z"></path>
      <path d="M4 20l6.768 -6.768m2.46 -2.46l6.772 -6.772"></path>
    </svg>
    <span>X</span>
  </a>

  <a
    href={linkedinUrl}
    target="_blank"
    rel="noopener noreferrer"
    class="share-btn share-linkedin"
    aria-label="Share on LinkedIn"
  >
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
      <rect x="2" y="9" width="4" height="12"></rect>
      <circle cx="4" cy="4" r="2"></circle>
    </svg>
    <span>LinkedIn</span>
  </a>

  <button
    class="share-btn share-copy"
    data-url={url}
    aria-label="Copy link to clipboard"
  >
    <svg class="copy-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
    </svg>
    <svg class="check-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="20 6 9 17 4 12"></polyline>
    </svg>
    <span class="copy-text">Copy Link</span>
    <span class="copied-text">Copied!</span>
  </button>
</div>

<style>
  .share-buttons {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1.5rem 0;
    margin: 2rem 0;
    border-top: 1px solid var(--color-border-light);
    border-bottom: 1px solid var(--color-border-light);
  }

  .share-label {
    font-size: var(--font-size-sm);
    font-weight: 500;
    color: var(--color-text-medium);
    margin-right: 0.25rem;
  }

  .share-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    padding: 0.5rem 0.85rem;
    background: var(--color-bg-light);
    color: var(--color-text);
    border: 1px solid var(--color-border);
    border-radius: 0.375rem;
    font-size: var(--font-size-sm);
    font-weight: 500;
    text-decoration: none;
    cursor: pointer;
    transition: all var(--transition-fast);
  }

  .share-btn:hover {
    background: var(--color-accent);
    color: #ffffff;
    border-color: var(--color-accent-dark);
    transform: translateY(-1px);
    text-decoration: none;
  }

  .share-btn:focus-visible {
    outline: 2px solid var(--color-accent);
    outline-offset: 2px;
    border-radius: 0.375rem;
  }

  .share-btn svg {
    flex-shrink: 0;
  }

  /* Copy button specific states */
  .share-copy {
    position: relative;
  }

  .share-copy .check-icon,
  .share-copy .copied-text {
    display: none;
  }

  .share-copy.copied .copy-icon,
  .share-copy.copied .copy-text {
    display: none;
  }

  .share-copy.copied .check-icon,
  .share-copy.copied .copied-text {
    display: inline;
  }

  .share-copy.copied {
    background: var(--color-accent);
    color: #ffffff;
    border-color: var(--color-accent-dark);
  }

  /* Responsive: stack on mobile */
  @media (max-width: 480px) {
    .share-buttons {
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .share-label {
      width: 100%;
      margin-bottom: 0.25rem;
    }

    .share-btn {
      flex: 1;
      justify-content: center;
      min-width: calc(50% - 0.25rem);
    }

    .share-btn span {
      display: none;
    }
  }

  @media (min-width: 481px) and (max-width: 809px) {
    .share-btn span {
      display: inline;
    }
  }
</style>

<script>
  function initShareButtons() {
    const copyButtons = document.querySelectorAll('.share-copy');

    copyButtons.forEach((button) => {
      button.addEventListener('click', async () => {
        const url = button.getAttribute('data-url');
        if (!url) return;

        try {
          await navigator.clipboard.writeText(url);
          button.classList.add('copied');

          setTimeout(() => {
            button.classList.remove('copied');
          }, 2000);
        } catch (err) {
          console.error('Failed to copy link:', err);
        }
      });
    });
  }

  // Initialize on page load
  initShareButtons();

  // Re-initialize on Astro page transitions
  document.addEventListener('astro:page-load', initShareButtons);
</script>
