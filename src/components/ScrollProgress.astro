<div class="scroll-progress" data-scroll-progress>
  <div class="scroll-progress__track">
    <div class="scroll-progress__bar"></div>
  </div>
</div>

<style>
  :global(.scroll-progress) {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 6px;
    z-index: 1000;
    pointer-events: none;
  }

  .scroll-progress__track {
    width: 100%;
    height: 100%;
    background: rgba(23, 28, 38, 0.08);
  }

  .scroll-progress__bar {
    width: 100%;
    height: 100%;
    background: var(--color-accent, #e5fc81);
    transform-origin: left center;
    transform: scaleX(0);
    transition: transform 0.18s ease-out;
  }

  @media (prefers-reduced-motion: reduce) {
    .scroll-progress__bar {
      transition: none;
    }
  }
</style>

<script>
  if (typeof window !== 'undefined') {
    const bar = document.querySelector('[data-scroll-progress] .scroll-progress__bar');

    if (bar) {
      const update = () => {
        const max = document.documentElement.scrollHeight - window.innerHeight;
        const percent = max > 0 ? window.scrollY / max : 0;
        bar.style.transform = `scaleX(${Math.min(Math.max(percent, 0), 1)})`;
      };

      let frame = 0;
      const scheduleUpdate = () => {
        if (frame) return;
        frame = window.requestAnimationFrame(() => {
          update();
          frame = 0;
        });
      };

      window.addEventListener('scroll', scheduleUpdate, { passive: true });
      window.addEventListener('resize', scheduleUpdate);
      update();

      document.addEventListener('astro:after-swap', scheduleUpdate);
      document.addEventListener('astro:page-load', scheduleUpdate);
    }
  }
</script>
