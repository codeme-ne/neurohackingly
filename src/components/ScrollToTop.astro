---
// Scroll-to-top button with smooth animation and theme awareness
---

<button
  id="scroll-to-top"
  class="scroll-to-top"
  aria-label="Scroll to top"
  type="button"
>
  <svg
    width="20"
    height="20"
    viewBox="0 0 24 24"
    fill="none"
    stroke="currentColor"
    stroke-width="2"
    stroke-linecap="round"
    stroke-linejoin="round"
    aria-hidden="true"
  >
    <path d="M12 19V5M5 12l7-7 7 7"></path>
  </svg>
</button>

<style>
  .scroll-to-top {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    z-index: 30;
    padding: 0.75rem;
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: 0.5rem;
    color: var(--color-text);
    cursor: pointer;
    opacity: 0;
    visibility: hidden;
    transform: translateY(10px);
    transition:
      opacity var(--transition-base),
      visibility var(--transition-base),
      transform var(--transition-base),
      background var(--transition-fast),
      border-color var(--transition-fast),
      box-shadow var(--transition-fast);
    box-shadow:
      0 4px 6px -1px rgba(0, 0, 0, 0.1),
      0 2px 4px -1px rgba(0, 0, 0, 0.06);
  }

  .scroll-to-top.visible {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .scroll-to-top:hover {
    background: var(--color-bg-light);
    border-color: var(--color-accent);
    box-shadow:
      0 10px 15px -3px rgba(0, 0, 0, 0.1),
      0 4px 6px -2px rgba(0, 0, 0, 0.05);
    transform: translateY(-2px);
  }

  .scroll-to-top:active {
    transform: translateY(0);
  }

  .scroll-to-top:focus-visible {
    outline: 2px solid var(--color-accent);
    outline-offset: 2px;
  }

  /* Mobile adjustments */
  @media (max-width: 640px) {
    .scroll-to-top {
      bottom: 1.5rem;
      right: 1.5rem;
      padding: 0.65rem;
    }
  }
</style>

<script>
  function initScrollToTop() {
    const button = document.getElementById('scroll-to-top');
    if (!button) return;

    const SCROLL_THRESHOLD = 300;
    let ticking = false;

    // Throttled scroll handler using requestAnimationFrame
    function handleScroll() {
      if (!ticking) {
        window.requestAnimationFrame(() => {
          const scrolled = window.scrollY > SCROLL_THRESHOLD;
          button.classList.toggle('visible', scrolled);
          ticking = false;
        });
        ticking = true;
      }
    }

    // Smooth scroll to top
    function scrollToTop() {
      window.scrollTo({
        top: 0,
        behavior: 'smooth',
      });
    }

    // Event listeners
    window.addEventListener('scroll', handleScroll, { passive: true });
    button.addEventListener('click', scrollToTop);

    // Initial check
    handleScroll();
  }

  // Initialize on page load
  initScrollToTop();

  // Re-initialize on view transitions (Astro)
  document.addEventListener('astro:page-load', initScrollToTop);
</script>
