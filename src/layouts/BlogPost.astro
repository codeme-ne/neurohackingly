---
import { Image } from 'astro:assets';
import SEO from '../components/SEO.astro';
import '../styles/global.css';

interface Props {
  title: string;
  description: string;
  pubDate: Date;
  updatedDate?: Date;
  author: string;
  image?: { url: string; alt: string };
  hero?: ImageMetadata;
  tags?: string[];
  page?: boolean;
}

const {
  title, description, pubDate, updatedDate, author, image, hero, tags = [],
  page: isPage = false
} = Astro.props;

// Reading time calculation (simple: ~200 words/min)
const content = await Astro.slots.render('default');
const wordCount = content.split(/\s+/).length;
const readingTime = Math.ceil(wordCount / 200);

// Schema.org structured data
const schema = {
  '@context': 'https://schema.org',
  '@type': isPage ? 'WebPage' : 'BlogPosting',
  headline: title,
  description: description,
  image: image?.url,
  datePublished: pubDate.toISOString(),
  dateModified: (updatedDate || pubDate).toISOString(),
  author: {
    '@type': 'Person',
    name: author,
    url: 'https://neurohackingly.com/about'
  },
  publisher: {
    '@type': 'Organization',
    name: 'Neurohackingly',
    logo: {
      '@type': 'ImageObject',
      url: 'https://neurohackingly.com/logo.png'
    }
  }
};
---

<!DOCTYPE html>
<html lang="en">
<head>
  <SEO
    title={`${title} | Neurohackingly`}
    description={description}
    image={image?.url}
    article={!isPage}
    publishedTime={pubDate}
    modifiedTime={updatedDate}
    tags={tags}
  />
  <script type="application/ld+json" set:html={JSON.stringify(schema)} />
</head>
<body>
  <nav>
    <a href="/">← Home</a>
    <a href="/blog">Blog</a>
    <a href="/blog/impossiblelist">Impossible List</a>
    <a href="/blog/now">Now</a>
    <a href="/newsletter">Newsletter</a>
  </nav>

  <main>
    <article>
      <header>
        {hero ? (
          <Image
            src={hero}
            alt={image?.alt ?? ''}
            widths={[720, 1024, 1440]}
            sizes="(max-width: 720px) 100vw, 720px"
            formats={['avif', 'webp', 'jpeg']}
            class="feature-image"
            loading="lazy"
            decoding="async"
          />
        ) : image && (
          <img src={image.url} alt={image.alt} class="feature-image" loading="lazy" decoding="async" />
        )}
        <h1>{title}</h1>
        {!isPage && (
          <div class="meta">
            <time datetime={pubDate.toISOString()}>
              {pubDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
            </time>
            <span>·</span>
            <span>{readingTime} min read</span>
            <span>·</span>
            <span>{author}</span>
          </div>
        )}
        {!isPage && tags.length > 0 && (
          <div class="tags">
            {tags
              .filter(t => !t.toLowerCase().startsWith('hash-'))
              .map(tag => (
                <a href={`/blog/tag/${encodeURIComponent(tag)}`} class="tag">#{tag}</a>
              ))}
          </div>
        )}
      </header>

      <div class="content">
        <slot />
      </div>
    </article>

    <footer>
      <p>© 2025 Neurohackingly by Lukas Zangerl</p>
    </footer>
  </main>
</body>
</html>
